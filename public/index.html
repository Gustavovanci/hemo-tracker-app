<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- T√≠tulo e Metadados do PWA -->
    <title>HemoFlow - Tracker Avan√ßado</title>
    <meta name="theme-color" content="#1e1b4b">
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link href="../output.css" rel="stylesheet">
    
    <!-- Meta tags para melhor SEO e compartilhamento -->
    <meta name="description" content="Sistema avan√ßado de tracking hemodin√¢mico com analytics preditivos e otimiza√ß√£o de fluxo">
    <meta name="keywords" content="hemodin√¢mica, tracking, healthcare, analytics, otimiza√ß√£o">
    <meta name="author" content="HemoFlow Team">
    
    <!-- Open Graph para compartilhamento -->
    <meta property="og:title" content="HemoFlow - Sistema de Tracking Hemodin√¢mico">
    <meta property="og:description" content="Otimize o fluxo da sua hemodin√¢mica com analytics avan√ßados">
    <meta property="og:type" content="website">
    
    <!-- √çcones para diferentes dispositivos -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
</head>
<body class="bg-gradient-app min-h-screen">

    <div class="container mx-auto px-4 py-6 max-w-2xl">
        
        <!-- Cabe√ßalho Aprimorado -->
        <header class="text-center mb-8 animate-fade-in-down">
            <div class="flex items-center justify-center mb-4">
                <div class="bg-glass-morphism rounded-full p-4 mr-4">
                    <span class="text-4xl">ü´Ä</span>
                </div>
                <div>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-2 text-gradient">HemoFlow</h1>
                    <p class="text-lg text-white/80 font-light">Sistema Avan√ßado de Analytics Hemodin√¢mico</p>
                </div>
            </div>
            
            <!-- Status do Sistema -->
            <div class="glass-morphism rounded-xl p-3 mb-4">
                <div class="flex items-center justify-between text-sm text-white/80">
                    <span id="system-status" class="flex items-center">
                        <span class="w-2 h-2 bg-success-500 rounded-full mr-2 animate-pulse"></span>
                        Sistema Online
                    </span>
                    <span id="last-sync">√öltima sync: --</span>
                </div>
            </div>
        </header>

        <!-- Scanner Section Melhorado -->
        <div class="glass-card">
            <div class="text-center mb-6">
                <h3 class="text-xl font-semibold text-white mb-2">üì± Scanner de Pulseira</h3>
                <p class="text-white/70 text-sm">Escaneie o QR Code ou digite o ID do paciente</p>
            </div>
            
            <!-- Camera Preview -->
            <div id="reader" class="w-full rounded-xl overflow-hidden mb-4" style="display: none;">
                <div id="camera-view"></div>
            </div>
            
            <!-- Controles do Scanner -->
            <div class="space-y-4">
                <button id="start-scan-btn" class="scan-button">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7V5C3 3.89543 3.89543 3 5 3H7M17 3H19C20.1046 3 21 3.89543 21 5V7M21 17V19C21 20.1046 20.1046 21 19 21H17M7 21H5C3.89543 21 3 20.1046 3 19V17M12 8V16M8 12H16" />
                    </svg>
                    Escanear Pulseira do Paciente
                </button>
                
                <!-- Input manual como alternativa -->
                <div class="flex gap-2">
                    <input type="text" id="manual-patient-id" 
                           placeholder="Ou digite o ID do paciente..." 
                           class="flex-1 px-4 py-3 rounded-xl bg-glass text-white placeholder-white/50 border border-glass-border focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <button id="manual-submit-btn" class="px-6 py-3 bg-accent-500 hover:bg-accent-600 rounded-xl text-white font-medium transition-colors">
                        OK
                    </button>
                </div>
            </div>
            
            <!-- Status do Scanner -->
            <div id="scanner-status" class="text-center text-white/60 text-sm mt-4" style="display: none;">
                <div class="loading inline-block mr-2"></div>
                Inicializando c√¢mera...
            </div>
            
            <!-- Paciente Identificado -->
            <div class="patient-info" id="patient-info" style="display: none;">
                <h3 class="text-lg font-semibold text-white mb-3">üìã Paciente Identificado</h3>
                <div class="patient-id bg-accent-500/10 border border-accent-500/30 rounded-xl p-4" id="patient-id"></div>
                
                <!-- Info adicional do paciente -->
                <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                    <div class="glass-morphism-light rounded-lg p-3 text-center">
                        <div class="text-white/60">Hora de Entrada</div>
                        <div class="text-white font-semibold" id="entry-time">--:--</div>
                    </div>
                    <div class="glass-morphism-light rounded-lg p-3 text-center">
                        <div class="text-white/60">Status</div>
                        <div class="text-success-400 font-semibold">Em Atendimento</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Section Aprimorada -->
        <div class="glass-card" id="timeline-section" style="display: none;">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-white">‚è±Ô∏è Timeline do Procedimento</h2>
                <div class="glass-morphism-light rounded-lg px-3 py-1 text-sm text-white/80">
                    <span id="current-step">Etapa 1/9</span>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="w-full bg-glass rounded-full h-2">
                    <div id="progress-bar" class="bg-gradient-to-r from-primary-500 to-secondary-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <div class="text-center text-white/60 text-sm mt-2">
                    <span id="progress-text">0% conclu√≠do</span>
                </div>
            </div>
            
            <div class="timeline-container">
                <div class="timeline-line"></div>
                
                <!-- Etapa 1 -->
                <div class="timeline-step" data-step="1">
                    <div class="step-indicator pending" id="step1">1</div>
                    <div class="step-content">
                        <div class="step-title">üö™ Chegada na Hemodin√¢mica</div>
                        <div class="step-time" id="time1">--:--:--</div>
                        <div class="step-duration" id="duration1"></div>
                    </div>
                </div>

                <!-- Etapa 2 -->
                <div class="timeline-step" data-step="2">
                    <div class="step-indicator pending" id="step2">2</div>
                    <div class="step-content">
                        <div class="step-title">üè• Entrada na Sala</div>
                        <div class="step-time" id="time2">--:--:--</div>
                        <div class="step-duration" id="duration2"></div>
                    </div>
                </div>

                <!-- Etapa 3 -->
                <div class="timeline-step" data-step="3">
                    <div class="step-indicator pending" id="step3">3</div>
                    <div class="step-content">
                        <div class="step-title">üõ°Ô∏è In√≠cio da Cobertura</div>
                        <div class="step-time" id="time3">--:--:--</div>
                        <div class="step-duration" id="duration3"></div>
                    </div>
                </div>

                <!-- Etapa 4 -->
                <div class="timeline-step" data-step="4">
                    <div class="step-indicator pending" id="step4">4</div>
                    <div class="step-content">
                        <div class="step-title">‚úÖ T√©rmino da Cobertura</div>
                        <div class="step-time" id="time4">--:--:--</div>
                        <div class="step-duration" id="duration4"></div>
                    </div>
                </div>

                <!-- Etapa 5 -->
                <div class="timeline-step" data-step="5">
                    <div class="step-indicator pending" id="step5">5</div>
                    <div class="step-content">
                        <div class="step-title">üî¨ In√≠cio do Procedimento</div>
                        <div class="step-time" id="time5">--:--:--</div>
                        <div class="step-duration" id="duration5"></div>
                    </div>
                </div>

                <!-- Etapa 6 -->
                <div class="timeline-step" data-step="6">
                    <div class="step-indicator pending" id="step6">6</div>
                    <div class="step-content">
                        <div class="step-title">‚ú® T√©rmino do Procedimento</div>
                        <div class="step-time" id="time6">--:--:--</div>
                        <div class="step-duration" id="duration6"></div>
                    </div>
                </div>

                <!-- Etapa 7 -->
                <div class="timeline-step" data-step="7">
                    <div class="step-indicator pending" id="step7">7</div>
                    <div class="step-content">
                        <div class="step-title">üö™ Sa√≠da da Sala</div>
                        <div class="step-time" id="time7">--:--:--</div>
                        <div class="step-duration" id="duration7"></div>
                    </div>
                </div>

                <!-- Etapa 8 -->
                <div class="timeline-step" data-step="8">
                    <div class="step-indicator pending" id="step8">8</div>
                    <div class="step-content">
                        <div class="step-title">üßΩ In√≠cio da Limpeza</div>
                        <div class="step-time" id="time8">--:--:--</div>
                        <div class="step-duration" id="duration8"></div>
                    </div>
                </div>

                <!-- Etapa 9 -->
                <div class="timeline-step" data-step="9">
                    <div class="step-indicator pending" id="step9">9</div>
                    <div class="step-content">
                        <div class="step-title">üéØ T√©rmino da Limpeza</div>
                        <div class="step-time" id="time9">--:--:--</div>
                        <div class="step-duration" id="duration9"></div>
                    </div>
                </div>
            </div>

            <!-- Controles da Timeline -->
            <div class="action-buttons">
                <button class="action-button success" id="next-step-btn" disabled>
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13L9 17L19 7" />
                    </svg>
                    Pr√≥xima Etapa
                </button>
                <button class="action-button danger" id="reset-btn">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 9a9 9 0 0114.53-2.828A8.973 8.973 0 0120 12m-4.53 2.828A9 9 0 015.47 14.828 8.973 8.973 0 014 12" />
                    </svg>
                    Resetar
                </button>
            </div>
        </div>

        <!-- Analytics em Tempo Real (NOVO) -->
        <div class="glass-card" id="analytics-section" style="display: none;">
            <h2 class="text-xl font-semibold text-white mb-6">ü§ñ Analytics Preditivos</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Previs√£o de Tempo -->
                <div class="glass-morphism-light rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <span class="text-2xl mr-2">‚è∞</span>
                        <div>
                            <h4 class="text-white font-semibold">Previs√£o de Conclus√£o</h4>
                            <p class="text-white/60 text-sm">Baseado em hist√≥rico</p>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-accent-400" id="predicted-completion">--:--</div>
                </div>
                
                <!-- Status de Performance -->
                <div class="glass-morphism-light rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <span class="text-2xl mr-2">üìä</span>
                        <div>
                            <h4 class="text-white font-semibold">Performance</h4>
                            <p class="text-white/60 text-sm">vs. m√©dia hist√≥rica</p>
                        </div>
                    </div>
                    <div class="text-2xl font-bold" id="performance-status">
                        <span class="text-success-400">‚úì No prazo</span>
                    </div>
                </div>
            </div>
            
            <!-- Alertas Inteligentes -->
            <div id="smart-alerts" class="space-y-2">
                <!-- Os alertas ser√£o inseridos dinamicamente aqui -->
            </div>
        </div>

        <!-- Stats Dashboard Melhorado -->
        <div class="glass-card" id="stats-section" style="display: none;">
            <h2 class="text-xl font-semibold text-white mb-6">üìä M√©tricas do Procedimento</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="flex items-center mb-2">
                        <span class="text-xl mr-2">‚è±Ô∏è</span>
                        <span class="text-white/80 text-sm">Tempo Total</span>
                    </div>
                    <div class="stat-value" id="total-time">--</div>
                    <div class="text-xs text-white/60" id="total-time-comparison">vs. m√©dia: --</div>
                </div>
                
                <div class="stat-card">
                    <div class="flex items-center mb-2">
                        <span class="text-xl mr-2">üî¨</span>
                        <span class="text-white/80 text-sm">Procedimento</span>
                    </div>
                    <div class="stat-value" id="procedure-time">--</div>
                    <div class="text-xs text-white/60" id="procedure-time-comparison">vs. m√©dia: --</div>
                </div>
                
                <div class="stat-card">
                    <div class="flex items-center mb-2">
                        <span class="text-xl mr-2">‚öôÔ∏è</span>
                        <span class="text-white/80 text-sm">Prepara√ß√£o</span>
                    </div>
                    <div class="stat-value" id="setup-time">--</div>
                    <div class="text-xs text-white/60" id="setup-time-comparison">vs. m√©dia: --</div>
                </div>
                
                <div class="stat-card">
                    <div class="flex items-center mb-2">
                        <span class="text-xl mr-2">üßΩ</span>
                        <span class="text-white/80 text-sm">Limpeza</span>
                    </div>
                    <div class="stat-value" id="cleaning-time">--</div>
                    <div class="text-xs text-white/60" id="cleaning-time-comparison">vs. m√©dia: --</div>
                </div>
            </div>
            
            <!-- Gr√°fico de Performance (placeholder) -->
            <div class="mt-6">
                <h3 class="text-white font-semibold mb-3">üìà Tend√™ncia de Performance</h3>
                <div class="glass-morphism-light rounded-xl p-4 text-center text-white/60">
                    <div class="h-32 flex items-center justify-center">
                        <span>Gr√°fico de tend√™ncia ser√° exibido aqui</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Actions Melhorado -->
        <div class="glass-card" id="final-section" style="display: none;">
            <h2 class="text-xl font-semibold text-white mb-6">‚úÖ Finalizar Atendimento</h2>
            
            <div class="space-y-4">
                <!-- Sele√ß√£o de Sala -->
                <div>
                    <label for="sala-select" class="form-label">üè• Sala:</label>
                    <select id="sala-select" class="form-select">
                        <option value="">Selecione a sala...</option>
                        <option value="Sala 1">Sala 1 - Hemodin√¢mica Principal</option>
                        <option value="Sala 2">Sala 2 - Cardiologia Intervencionista</option>
                        <option value="Sala 3">Sala 3 - Neurologia Intervencionista</option>
                        <option value="Sala 4">Sala 4 - Radiologia Intervencionista</option>
                        <option value="Sala 5">Sala 5 - Emerg√™ncia</option>
                    </select>
                </div>
                
                <!-- Destino do Paciente -->
                <div>
                    <label for="leito-select" class="form-label">üèÉ‚Äç‚ôÇÔ∏è Destino do Paciente:</label>
                    <select id="leito-select" class="form-select">
                        <option value="">Selecione o destino...</option>
                        <option value="Recupera√ß√£o 1">Recupera√ß√£o 1</option>
                        <option value="Recupera√ß√£o 2">Recupera√ß√£o 2</option>
                        <option value="UTI Cardiol√≥gica">UTI Cardiol√≥gica</option>
                        <option value="UTI Geral">UTI Geral</option>
                        <option value="Apartamento">Apartamento</option>
                        <option value="Enfermaria">Enfermaria</option>
                        <option value="Alta Hospitalar">Alta Hospitalar</option>
                    </select>
                </div>
                
                <!-- Observa√ß√µes Opcionais -->
                <div>
                    <label for="observations" class="form-label">üìù Observa√ß√µes (opcional):</label>
                    <textarea id="observations" 
                              placeholder="Observa√ß√µes sobre o procedimento..."
                              class="w-full px-4 py-3 rounded-xl bg-glass text-white placeholder-white/50 border border-glass-border focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none"
                              rows="3"></textarea>
                </div>
            </div>
            
            <!-- Resumo Final -->
            <div class="mt-6 glass-morphism-light rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3">üìã Resumo Final</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-white/60">Paciente:</span>
                        <span class="text-white font-medium ml-2" id="final-patient-id">--</span>
                    </div>
                    <div>
                        <span class="text-white/60">Dura√ß√£o Total:</span>
                        <span class="text-white font-medium ml-2" id="final-total-time">--</span>
                    </div>
                </div>
            </div>
            
            <!-- Bot√£o de Salvar -->
            <button class="action-button primary w-full mt-6" id="checkout-btn" disabled>
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M20 6L9 17L4 12" />
                </svg>
                Salvar no Google Sheets & Gerar Relat√≥rio
            </button>
            
            <!-- Status de Salvamento -->
            <div id="save-status" class="text-center text-white/60 text-sm mt-4" style="display: none;">
                <div class="loading inline-block mr-2"></div>
                Salvando dados...
            </div>
        </div>

        <!-- Notifica√ß√µes Toast -->
        <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2">
            <!-- Notifica√ß√µes ser√£o inseridas aqui dinamicamente -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="script.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registrado:', registration);
                    })
                    .catch(error => {
                        console.log('SW falhou:', error);
                    });
            });
        }
    </script>
</body>
</html>